/*! blocks - v0.1.0 - 2014-07-25
* Copyright (c) 2014 Douglas Tarr; Licensed  */
var blocks=blocks||{};blocks.backdrop=function(a,b,c){this.stage=a,this.name=b,this.url=c},blocks.color=function(a,b,c,d){this.r=a,this.g=b,this.b=c,this.a=d,this.equals=function(a){return a.r==this.r&&a.g==this.g&&a.b==this.b&&a.a==this.a},this.toString=function(){return"["+this.r+","+this.g+","+this.b+","+this.a+"]"},this.inRange=function(a,b,c){return b>a-c&&a+c>b?!0:!1},this.inImageDataBoundary=function(a,b,c,d,e){for(var f=0;f<a.data.length/4;f+=4){bmpWidth=b+2*d;var g=Math.floor(f/bmpWidth),h=f%bmpWidth;if(!(h>d&&b+d>h&&g>d&&c+d>g)){{var i=a.data[f],j=a.data[f+1],k=a.data[f+2];a.data[f+3]}if(this.inRange(this.r,i,e)&&this.inRange(this.g,j,e)&&this.inRange(this.b,k,e))return!0}}return!1}},blocks.project=function(a){function b(){var a=d.input.mousePointer.x,b=d.input.mousePointer.y,c=d.canvas.getContext("2d"),e=c.getImageData(a,b,1,1);console.log(e.data[0]+","+e.data[1]+","+e.data[2]+","+e.data[3])}var c=this;this.parent=a;var d={},e=[];this._sounds=[],this.sounds={add:function(a,b){var d=new blocks.sound(c,a,b);return c._sounds.push(d),d}};_stage=new blocks.stage(this),this.stage=_stage,this.sprites={add:function(a,b,c){var d=new blocks.sprite(this,a,b,c);return e.push(d),d}},this.preload=function(){c._sounds.forEach(function(a){d.load.audio(a.name,[a.url])}),e.forEach(function(a){a.costumes.forEach(function(a){d.load.image(a.name,a.url)})}),_stage._backdrops.forEach(function(a){d.load.image(a.name,a.url)})},this.create=function(){d.physics.startSystem(Phaser.Physics.ARCADE),c._sounds.forEach(function(a){a.game_sound=d.add.audio(a.name)}),_stage._backdrops.forEach(function(a){d.add.sprite(0,0,a.name)}),e.forEach(function(a){var b=d.add.sprite(a.x,a.y,a.costumes[0].name);b.anchor.setTo(.5,.5),b.inputEnabled=!0,b.input.start(),d.physics.enable(b,Phaser.Physics.ARCADE),b.body.immovable=!0,b.block_sprite=a,a.game_sprite=b,a.key_callbacks.forEach(function(b){b.game_key=d.input.keyboard.addKey(b.keycode),b.game_key.onDown.add(function(c){b.callback(a,c)},this)})}),d.input.onDown.add(b,this)},this.update=function(){e.forEach(function(a){a.game_sprite.input.checkPointerDown(d.input.activePointer)&&a.click_callbacks.forEach(function(b){b(a)}),a.touching_callbacks.forEach(function(b){d.physics.arcade.overlap(a.game_sprite,b.sprite.game_sprite,b.cb)}),a.touching_color_callbacks.forEach(function(b){var c=d.canvas.getContext("2d"),e=2,f=c.getImageData(a.game_sprite.body.x-e,a.game_sprite.body.y-e,a.game_sprite.width+2*e,a.game_sprite.height+2*e);b.color.inImageDataBoundary(f,a.game_sprite.width,a.game_sprite.height,e,10)&&b.cb(a)})})},this.start=function(){d=new Phaser.Game(800,600,Phaser.CANVAS,"",{preload:this.preload,create:this.create,update:this.update})},this.green_flag={callbacks:[],clicked:function(a){this.callbacks.push(a)},click:function(){this.callbacks.forEach(function(a){a()})}}},blocks.sound=function(a,b,c){this.sprite=a,this.name=b,this.url=c,this.play=function(){this.game_sound.play()}},blocks.sprite=function(a,b,c,d){this.click_callbacks=[],this.touching_callbacks=[],this.touching_color_callbacks=[],this.key_callbacks=[],this.name=b,this.x=c,this.y=d,this.costumes=[{id:1,name:b,url:b}],this.move=function(a){this.game_sprite.body.x+=a},this.clicked=function(a){this.click_callbacks.push(a)},this.when_key_is_pressed=function(a,b){this.key_callbacks.push({keycode:a,callback:b})},this.when_touching=function(a,b){this.touching_callbacks.push({sprite:a,cb:function(a,c){b(a.block_sprite,c.block_sprite)}})},this.when_touching_color=function(a,b){this.touching_color_callbacks.push({color:a,cb:function(a){b(a)}})},this.hide=function(){this.game_sprite.visible=!1},this.show=function(){this.game_sprite.visible=!0},this.clone=function(){}},blocks.stage=function(a){var b=this;this.project=a,this._backdrops=[],this.backdrops={add:function(a,c){var d=new blocks.backdrop(b,a,c);b._backdrops.push(d)}}};